<!------ TABLA ------>

<div class="container">
  <div class="row">

    <div class="col-12">
      <h1 class="text-center mt-3 text-dark-emphasis">{{'Detalle de caja'}}</h1>
      <h6 class="mt-3" [ngClass]="{'text-danger': !invHabilitado, 'text-secondary': invHabilitado}">{{descripcion}}</h6>
    </div>

    <div class="col offset-md-9 col-md-3" *ngIf="invHabilitado">
      <div class="d-grid gap-2 my-2">
        <button class="btn btn-danger" (click)="enviar()">Enviar</button>
      </div>
    </div>

    <div class="col-12">
      <div class="text-center" *ngIf="cargandoOperacion">
        <div class="spinner-border text-danger" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <!-- <div class="text-center text-danger">
          Registrando el inventario..
        </div> -->
      </div>
    </div>

    <div class="col-12" *ngIf="cargandoTabla">

      <div class="text-center">
        <div class="spinner-border text-danger" style="width: 3rem; height: 3rem;" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
      <!-- <div class="text-center text-danger">
        Obteniendo billetes...
      </div> -->
    </div>

    <div class="col-12">
      <form [formGroup]="form" *ngIf="invHabilitado">
        <!--
          [formGroup]="form": Asocia el formulario al FormGroup llamado "form" definido en el componente de Angular.
          *ngIf="invHabilitado": Muestra el formulario solo si la variable "invHabilitado" es verdadera.
        -->
      
        <div formArrayName="dineroControles">
          <!--
            div formArrayName="dineroControles": Establece que esta sección del formulario se gestionará como un FormArray llamado "dineroControles".
          -->
      
          <table class="table hover mt-2" datatable [dtOptions]="dtOptions">
            <!--
              table: Crea una tabla HTML.
              class="table hover mt-2": Aplica clases CSS para dar formato a la tabla.
              datatable [dtOptions]="dtOptions": Configura la tabla utilizando opciones definidas en el componente.
            -->
      
            <thead class="bg-warning">
              <tr>
                <th class="text-center">Nombre</th>
                <th class="text-center">Monto</th>
                <th class="text-center">Cantidad</th>
                <th class="text-center">Observacion</th>
              </tr>
            </thead>
      
            <tbody>
              <!-- Aquí se crea una fila por cada elemento "dinero" en la colección "dineros" -->
              <tr *ngFor="let dinero of dineros; let i = index;" [formGroupName]="i">
                <!--
                  *ngFor="let dinero of dineros; let i = index;": Itera sobre la colección "dineros" y asigna un índice "i" a cada elemento.
                  [formGroupName]="i": Asocia cada fila a un elemento específico en el FormArray "dineroControles" utilizando el índice "i".
                -->
      
                <td class="text-start">{{ dinero.nombreBillete | titlecase }}</td>
                <!-- Muestra el nombre del billete y lo convierte a título (mayúsculas y minúsculas). -->
      
                <td class="text-end">{{ dinero.monto | number}}</td><!--number:'1.2-2'-->
                <!-- Muestra el monto del billete y lo formatea como número. -->
      
                <td class="col-2">
                  <div>
                    <input type="number" class="form-control" formControlName="cantidad" [id]="'dineroControles-'+i+'-cantidad'">
                    <!--
                      Crea un campo de entrada numérica asociado al FormControl "cantidad".
                      [id]="'dineroControles-'+i+'-cantidad'": Asigna un ID único al campo de entrada.
                    -->
      
                    <!-- Muestra un mensaje de error si el campo "cantidad" es inválido -->
                    <span *ngIf="datoInvalido('cantidad', 'dineroControles', i)" class="e-mensaje-error">
                      {{ mensajeValidacion('cantidad', form.get('dineroControles')!.get(i.toString())!) }}
                    </span>
                  </div>
                </td>
      
                <td class="col-2">
                  <div>
                    <input type="text" class="form-control" formControlName="observacion"><!-- [id]="'dineroControles-'+i+'-observacion'"-->
                    <!-- Crea un campo de entrada de texto asociado al FormControl "observacion". -->
      
                    <!-- Muestra un mensaje de error si el campo "observacion" es inválido -->
                    <span *ngIf="datoInvalido('observacion', 'dineroControles', i)" class="e-mensaje-error" >
                      {{ mensajeValidacion('observacion', form.get('dineroControles')!.get(i.toString())!) }}
                    </span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </form>
      
      <!-- <form [formGroup]="form" *ngIf="invHabilitado">
        <div formArrayName="dineroControles">
          <table class="table hover mt-2" datatable [dtOptions]="dtOptions">
            <thead class="bg-warning">
              <tr>
                <th class="text-center">Nombre</th>
                <th class="text-center">Monto</th>
                <th class="text-center">Cantidad</th>
                <th class="text-center">Observacion</th>
              </tr>
            </thead>

            <tbody>
              <tr *ngFor="let dinero of dineros; let i = index;" [formGroupName]="i">
                <td class="text-start">{{ dinero.nombreBillete | titlecase }}</td>
                <td class="text-end">{{ dinero.monto | number}}</td>
                <td class="col-2">
                  <div>
                    <input type="number" class="form-control" formControlName="cantidad" [id]="'dineroControles-'+i+'-cantidad'">
                    <span *ngIf="datoInvalido('cantidad', 'dineroControles', i)" class="e-mensaje-error">
                      {{ mensajeValidacion('cantidad', form.get('dineroControles')!.get(i.toString())!) }}
                    </span>
                  </div>
                </td>
                <td class="col-2">
                  <div>
                    <input type="text" class="form-control" formControlName="observacion">
                    <span *ngIf="datoInvalido('observacion', 'dineroControles', i)" class="e-mensaje-error" >
                      {{ mensajeValidacion('observacion', form.get('dineroControles')!.get(i.toString())!) }}
                    </span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </form> -->
    </div>
  </div>
</div>